#!/usr/bin/bash

# set -euo pipefail

SCRIPT_NAME="${0##*/}"
NOTES_DIR="${HOME}/org"
timestamp=$(date +%Y%m%dT%H:%M:%S)
LOG_DIR="${HOME}/.log"
log_file="${LOG_DIR}/org-sync.log"

usage() {
    cat<<EOF
USAGE:
    $SCRIPT_NAME [OPTIONS] ACTIONS [PATH ...]
EOF
}
sync_note() {
    # /usr/bin/git -C "$NOTES_DIR" stash
    /usr/bin/git -C "$NOTES_DIR" add --all
    # /usr/bin/git -C "$NOTES_DIR" commit -m "New notes added"
    # /usr/bin/git -C "$NOTES_DIR" stash pop
    /usr/bin/git -C "$NOTES_DIR" commit -a -m "Synced modified notes at $timestamp"
    /usr/bin/git -C "$NOTES_DIR" push -v &> "$log_file"
}

if [[ -z $(git -C "$NOTES_DIR" status --porcelain) ]]; then
    echo "Nothing to commit at $timestamp" >> "$log_file"
    /usr/bin/git -C "$NOTES_DIR" push -v
else
    # needed to push to my github account
    # As I don't use the creditential I need a way to identify
    # That is what I use into my .zprofile
    eval "$(/usr/bin/keychain --eval --agents ssh github)"
    sync_note
fi


# -- Generated by estow.el --

